
        /// <summary>
        /// NOVA ROTINA DE VALORIZAÇÃO CONTÁBIL DE RENDA FIXA
        /// 
        /// 1- PEGA OS DADOS DA PARTIDA (ESTOQUE,BOLETO,MOVIMENTO,TITULO,NATUREZA OPERAÇÃO,SALDO,PREÇO,MERCADORIA,INDEXACAO,REPACTUAÇÃO,POSIÇÃO,INDEXADOR DE CUSTO)
        /// 2- VERIFICA A POSICAO PARA FERIADOS (EMPRESA DO GRUPO)
        /// 3- BUSCA O DIA UTIL ANTERIOR
        /// 4- SE A DATA INICIAL FOR ANTERIOR A PARTIDA, INICIA COM A PARTIDA
        /// 4- BUSCA DADOS DO TITULO
        /// 5- VERIFICA A FORMA DE CALCULO DO CUPOM
        /// 6- VERIFICA SE A POSICAO EH UM FUNDO
        /// 7- MUDA TIPO ESTOQUE DE ACORDO COM O CDCLFC3068
        /// 8- BUSCA DADOS DO TITULO
        /// 9- SE A DATA FINAL SOLICITADA PARA CALCULO FOR MAIOR QUE A DATA DE LIQUIDACAO DO TITULO, CALCULA ATE A MENOR DATA
        /// 10- VERIFICA A FORMA DE CALCULO DO CUPOM
        /// 11- Para Indexadores PRE e que tenham pagamento de Juros (NTN-F), forma do calculo do CUPOM deve ser 013
        /// 12- SE O TITULO NAO POSSUIR DATA BASE DE CALCULO, ASSUME A EMISSAO
        /// 13- NAO EH DIA UTIL
        /// 14- FLAG PARA SABER SE TRUNCA OU ARREDONDA O FINANCEIRO
        /// 15- VERIFICA SE A POSICAO EH UM FUNDO
        /// 16- PARA FUNDO COM ESTOQUE CONSOLIDADO, DEVE MARCAR MERCADO SE NÃO FOR A PRIMEIRA COMPRA DO ESTOQUE
        /// 17- CALCULA O PRIMEIRO ANIVERSARIO PARA INDEXADORES COM FORMA DE CALCULO 007
        /// 18- BUSCA DADOS DO DIA ANTERIOR
        /// 19- Para BS e Empresas seleciona juros/correcao anterior em d-1 (corridos)
        /// 20- DEFINE IDXCONTABIL DE ACORDO COM A MERCADORIA
        /// 21- AJUSTE NO JUROS E DA CORRECAO ANTERIOR QUANDO TEVE VENDA UM DIA ANTES
        /// 22- AJUSTA VALORES DE PREÇO
        /// 23- PEGA A AGENDA EVENTO
        /// 24- CALCULA A CORREÇÃO ANTERIOR
        /// 25- DEFINE BASE DE CÁLCULO
        /// 26- Pega qual é o Tipo da Operação, Se for 81 - Transferência de Custodia - DE, Calcula somente o primeiro e os ultimos x dias, conforme parametro na 515
        /// 27- APAGA OS PREÇOS NA DATA (REPROCESSAR)
        /// 28- VALORIZACAO DIA A DIA
        ///     28.1- PARA TITULOS PUBLICOS COM PAGAMENTO DE JUROS DEVE-SE VERIFICAR A DATA DE CORTE PARA UTILIZACAO DO CENARIO DE VENCIMENTO NO CALCULO DOS FLUXOS SE O CALCULO FOR ANTERIOR AO CORTE NAO UTILIZAR O VENCIMENTO
        ///     28.2- BUSCA AS QUANTIDADES DE COMPRA OU VENDA DO DIA
        ///     28.3- Para posicoes com Estoque Consolidado e que nao sejam NAO PADRONIZADAS, redefinir a Data e PU de Aquisicao, pois pode haver outras aquisicoes no periodo(Valorizacao LOTE)
        ///     28.4- SEPARA AS TAXAS UTEIS E CORRIDOS
        ///     28.5- SE A PROXIMA REPACTUACAO FOR CORRECAO, CALCULA A TAXA PRIMEIRO
        ///         28.5.1- Somente para titulos que NÃO são calculo manual (RFX_RESULTADO = '006')
        ///         28.5.1.1 Por causa do descasamento da data de vencimento com a data de liquidação do evento a valorização tem que usar como vencimento o último DT_EVE dos fluxos
        ///         28.5.2- A REPACTUACAO SEMPRE EXPIRA NA PROXIMA RESERVA
        ///     28.6- CALCULO DE DEBENTURES
        ///     28.7- SE FOR DATA DE AQUISICAO OU MES DE AQUISICAO(IGPM) RECALCULA A TIR NO MES DE MUDANCA DO PERIODO DE REPACTUACAO(APOS A REPAC.), TAMBEM.
        ///         28.7.1- SE FOI REPACTUADO O PU DE PARTIDA EH O PU NA DATA DE REPACTUACAO
        ///             28.7.1.1- SE FOR UM EVENTO DE CORRECAO, VERIFICA SE FOI DIGITADO O PU DE CORRECAO
        ///     28.8- SEPARADO PAGTO DE JUROS PARA NÃO RETORNAR O VALOR QUANDO NÃO HOUVER AMORTIZACAO
        ///     28.9- TRUNCA OU ARREDONDA OS PRINCIPAIS
        ///     28.10- CALCULA OS PUs
        ///         28.10.1- ESSE CALCULO SO DEVE SER FEITO PARA FUNDO ABERTURA E DIA DA VALORIZACAO DIFERENTE DO PRIMEIRO DIA
        ///         28.10.2- ARMAZENAMOS AQUI A CORRECAO DO DIA SEGUNDO O PU DE ABERTURA
        ///         28.10.3- CALCULO DO PU DIA POR AGIO/DESAGIO CONFORME O PADRAO CONTABIL EXISTENTE HOJE NO BANCO SAFRA - NAO DEVEMOS USAR A TAXA DA CARTEIRA PARA A CURVA CONTABIL
        ///             28.10.3.1- ARMAZENA O PU CONTABIL DA ABERTURA DO DIA UTILIZAMOS POSTERIORMENTE PARA CALCULO DO JUROS DO DIA
        ///     28.11- se tem pagto juros no dia do vencto, então zera o PU
        ///     28.12- APURA O PU MERCADO DE ACORDO COM RFX_RESULTADO
        ///     28.13- APURA O PU DE APROPRIACAO 
        ///     28.14- SE A DATA DE CALCULO FOR MUDANCA DE PERIODO DE REPACTUACAO, IGUALA OS PUS E RECALCULA UMA NOVA TIR.
        ///         28.14.1- SE A DATA DE CALCULO FOR A DATA DE VENCIMENTO DO TITULO NO PERIODO VIGENTE E EXISTIR REPACTUACAO APOS O VENCIMENTO, ADOTAR O NOMINAL DEVIDO COMO PU NO PONTO.
        ///         28.14.2- Somente para titulos que NÃO são calculo manual (RFX_RESULTADO = '006')
        ///             28.14.2.1- Por causa do descasamento da data de vencimento com a data de liquidação do evento a valorização tem que usar como vencimento o último DT_EVE dos fluxos
        ///         28.14.3- SE EXISTIR PERIODO POSTERIOR, AJUSTAR A DATA DA PROXIMA REPACTUACAO
        ///         28.14.4- SE O PROXIMO ID FOR CORRECAO, BUSCA A DATA DA PROXIMA REPACTUACAO
        ///             28.14.4.1- BUSCA A DATA INICIAL DA PROXIMA REPACTUACAO OU O VENCTO DO TITULO
        ///         28.14.5- VERIFICA A FORMA DE CALCULO DO CUPOM
        ///         28.14.6- SE FOR UM EVENTO DE CORRECAO, VERIFICA SE FOI DIGITADO O PU DE CORRECAO
        ///         28.14.7- SE MUDOU O PERIODO
        ///     28.15- SEPARA AS TAXAS UTEIS E CORRIDOS
        ///     28.16- INVERTEMOS A ORDEM DA BAIXA DE PRINCIPAL PARA CALCULO O CALCULO CORRETO DO PRINCIPAL MEDIO PRIMEIRO - BAIXAMOS O PRINCIPAL COM BASE NO PRINCIPAL DE FEC DE D-1 SEGUNDO - CALCULAMOS O NOVO PRINCIPAL DO DIA DESC.AS BAIXAS
        ///         28.16.1- SE FOR DIA UTIL VERIFICA O PAGAMENTO DE PRINCIPAL
        ///     28.17- INICIO TRATAMENTO PRINCIPAL MEDIO
        ///         28.17.1- ATUALIZA O PRINCIPAL E O FINANCEIRO DE AQUISICAO
        ///         28.17.2- VERIFICA O QUANTO AS VENDAS IMPACTARAM NO PRINCIPAL
        ///         28.17.3- PASSIVO - EMISSAO DA LEASING   
        ///     28.18- CALCULA JUROS E CORRECAO
        ///         28.18.1- Separacao do juros e atualizacao para as posicoes contabeis diferentes de fundos.
        ///         28.18.2- CORRECAO NA DATA DE VENCIMENTO
        ///              28.18.2.1- NO DIA DO VENCIMENTO DO TITULO, O VALOR DA CORRECAO EH A DIFERENCA ENTRE O VALOR EFETIVAMENTE PAGO NA AGENDA EVENTO, CONTRA O VALOR DO SALDO EVENTO DO DIA ANTERIOR
        ///              28.18.2.2- CORRECAO NOS DEMAIS DIAS
        ///              28.18.2.3- APURA O QUANTO FOI PAGO DE CORRECAO NO DIA ANTERIOR CONTRA A DATA DE AQUISICAO.
        ///              28.18.2.4- PARA O SAFRABM TEM AQUE SER A CORRECAO ANTES DO CALCULO DO PU MEDIO, O PU DE ABERTURA
        ///         28.18.3 SE NAO DESEJARMOS APROPRIAR CORRECAO E JUROS NO DIA DA VENDA/RECOMPRA SUBSTITUIR @RFS_QTDE POR @QTDE_SALDO
        ///             28.18.3.1- JA CALCULO O PU CONTABIL SOMANDO O PAGAMENTO DO DIA
        ///             28.18.3.2- DESCONTA PAGAMENTO DE JUROS
        /// 29- VERIFICA O CENARIO
